-- Helper to generate spaces
CREATE FUNCTION Spaces(n INTEGER) RETURNS CHARACTER
BEGIN
  DECLARE s CHARACTER '';
  DECLARE i INTEGER 1;
  WHILE i <= n DO
    SET s = s || ' ';
    SET i = i + 1;
  END WHILE;
  RETURN s;
END;

-- Normalize DFDL field: preserve value, enforce length, default to spaces
CREATE FUNCTION NormalizeField(inField CHARACTER, inLength INTEGER) RETURNS CHARACTER
BEGIN
  DECLARE s CHARACTER COALESCE(inField, '');

  -- If missing, fill with spaces
  IF s = '' THEN
    SET s = Spaces(inLength);
  END IF;

  -- Pad/trim to exact length
  RETURN SUBSTRING(s || Spaces(inLength) FROM 1 FOR inLength);
END;
