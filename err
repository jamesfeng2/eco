-- Helper: build N spaces (no RPAD/REPEAT needed)
CREATE FUNCTION Spaces(n INTEGER) RETURNS CHARACTER
BEGIN
  DECLARE s CHARACTER '';
  DECLARE i INTEGER 1;
  WHILE i <= n DO
    SET s = s || ' ';
    SET i = i + 1;
  END WHILE;
  RETURN s;
END;

-- Fixed DecodeAndPad: (returns CHARACTER of exactly inLength)
-- NOTE: If you’re assigning back to OutputRoot.DFDL, keep this pure CHARACTER.
CREATE FUNCTION DecodeAndPad(inField CHARACTER, inLength INTEGER) RETURNS CHARACTER
BEGIN
  -- If the schema already decoded correctly, you usually DON’T need extra CCSID casts here.
  DECLARE s CHARACTER COALESCE(inField, '');

  -- Right-pad with spaces then trim to exact length (works for both pad & trim)
  RETURN SUBSTRING(s || Spaces(inLength) FROM 1 FOR inLength);
END;
