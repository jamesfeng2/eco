CREATE FUNCTION DecodeAndPad(inField CHARACTER, inLength INTEGER) RETURNS CHARACTER
BEGIN
    DECLARE tmpBLOB BLOB;
    DECLARE tmpCHAR CHARACTER;

    -- Round-trip via blob in CCSID 273 if needed
    IF inField IS NOT NULL THEN
        SET tmpBLOB = CAST(inField AS BLOB CCSID 273);
        SET tmpCHAR = CAST(tmpBLOB AS CHARACTER CCSID 1208);
    ELSE
        SET tmpCHAR = ' '; -- default
    END IF;

    -- Pad/Trim to schema length
    IF LENGTH(tmpCHAR) < inLength THEN
        RETURN tmpCHAR || RPAD('', inLength - LENGTH(tmpCHAR), ' ');
    ELSEIF LENGTH(tmpCHAR) > inLength THEN
        RETURN SUBSTRING(tmpCHAR FROM 1 FOR inLength);
    ELSE
        RETURN tmpCHAR;
    END IF;
END;
